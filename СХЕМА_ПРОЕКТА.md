# 🗺 Визуальная схема проекта «Такси Жуково+»

## 🎯 Ваш статус: АДМИНИСТРАТОР (ID: 6840100810)

---

## 📊 Архитектура системы

```
┌─────────────────────────────────────────────────────────────────┐
│                    TELEGRAM BOT «ТАКСИ ЖУКОВО+»                 │
│                    Токен: 8447...VVj1M                          │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                       3 РОЛИ В СИСТЕМЕ                          │
├─────────────────┬───────────────────┬───────────────────────────┤
│                 │                   │                           │
│   👤 КЛИЕНТ    │    🚗 ВОДИТЕЛЬ    │   👨‍💼 АДМИНИСТРАТОР      │
│                 │                   │      (ВЫ)                 │
│  • Заказать     │  • Выйти на линию │  • Статистика            │
│  • История      │  • Принять заказ  │  • Управление            │
│  • Оценить      │  • Начать поездку │  • Верификация           │
│                 │  • Завершить      │  • Мониторинг            │
└─────────────────┴───────────────────┴───────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                   СИСТЕМА РАЙОНОВ (FIFO)                        │
│                                                                 │
│  📍 Новое Жуково    📍 Старое Жуково    📍 Мысовцево          │
│  📍 Авдон           📍 Уптино            📍 Дёма               │
│                                                                 │
│  Логика: Сначала район заказа → через 60 сек → Новое Жуково   │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                     БАЗА ДАННЫХ (SQLite)                        │
│                   taxi_zhukovo.db                               │
│                                                                 │
│  Таблицы:                                                       │
│  • users         → Все пользователи (клиенты, водители, админ) │
│  • drivers       → Профили водителей (авто, рейтинг, район)    │
│  • orders        → Заказы такси (статусы, цены, маршруты)      │
└─────────────────────────────────────────────────────────────────┘
```

---

## 🔄 Процесс заказа такси

```
┌─────────────┐
│   КЛИЕНТ    │
│  создаёт    │
│   заказ     │
└──────┬──────┘
       │
       ▼
┌─────────────────────────┐
│ Выбирает район: "Дёма"  │
│ Указывает адреса        │
│ Подтверждает заказ      │
└──────────┬──────────────┘
           │
           ▼
┌───────────────────────────────────────┐
│ СИСТЕМА УВЕДОМЛЯЕТ ВОДИТЕЛЕЙ          │
│                                       │
│ Шаг 1: Все водители из "Дёмы" (FIFO) │
│ ⏰ Ожидание 60 секунд                 │
│ Шаг 2: Водители из "Новое Жуково"    │
└───────────────┬───────────────────────┘
                │
                ▼
┌───────────────────────────────────────┐
│ ВОДИТЕЛЬ принимает заказ              │
└───────────────┬───────────────────────┘
                │
                ▼
┌───────────────────────────────────────┐
│ Статусы заказа:                       │
│                                       │
│ ⏳ pending      → Ожидает водителя    │
│ ✅ accepted     → Принят водителем    │
│ 🚗 in_progress  → Поездка в процессе  │
│ ✅ completed    → Завершена           │
└───────────────┬───────────────────────┘
                │
                ▼
┌───────────────────────────────────────┐
│ КЛИЕНТ оценивает водителя (1-5 ⭐)    │
│ Рейтинг водителя обновляется          │
└───────────────────────────────────────┘
```

---

## 👨‍💼 Функции администратора (ВЫ)

```
┌─────────────────────────────────────────────────────────────────┐
│                     ПАНЕЛЬ АДМИНИСТРАТОРА                        │
│                     ID: 6840100810                              │
└─────────────────────────────────────────────────────────────────┘
                              │
         ┌────────────────────┼────────────────────┐
         │                    │                    │
         ▼                    ▼                    ▼
┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐
│  /admin_stats   │  │  /list_drivers  │  │ /verify_driver  │
│                 │  │                 │  │                 │
│ 📊 Статистика:  │  │ 🚗 Список:      │  │ ✅ Верификация: │
│ • Пользователи  │  │ • Все водители  │  │ • Новый водитель│
│ • Водители      │  │ • Статусы       │  │ • Разрешение    │
│ • Заказы        │  │ • Рейтинги      │  │   принимать     │
│ • Средний чек   │  │ • Авто          │  │   заказы        │
└─────────────────┘  └─────────────────┘  └─────────────────┘
                              │
                              ▼
                    ┌─────────────────┐
                    │ /pending_orders │
                    │                 │
                    │ ⏳ Активные:    │
                    │ • Все заказы    │
                    │   ожидающие     │
                    │   водителя      │
                    └─────────────────┘
```

---

## 🗂 Структура файлов проекта

```
D:\TAXI_ЖУКОВО\
│
├── 📂 bot/                         ← Основной код бота
│   ├── config.py                   → Настройки (читает .env)
│   ├── main.py                     → Точка входа
│   │
│   ├── 📂 handlers/                ← Обработчики команд
│   │   ├── admin.py                → Команды админа
│   │   ├── driver.py               → Команды водителя
│   │   └── user.py                 → Команды клиента
│   │
│   ├── 📂 models/                  ← Модели базы данных
│   │   ├── user.py                 → Пользователи
│   │   ├── driver.py               → Водители
│   │   └── order.py                → Заказы
│   │
│   ├── 📂 services/                ← Бизнес-логика
│   │   ├── user_service.py         → Управление пользователями
│   │   ├── order_service.py        → Управление заказами
│   │   └── pricing_service.py      → Расчёт цен
│   │
│   └── 📂 utils/                   ← Вспомогательные функции
│       └── keyboards.py            → Клавиатуры бота
│
├── 📂 database/                    ← База данных
│   ├── db.py                       → Настройка SQLAlchemy
│   └── 📂 migrations/              → Миграции
│       └── add_district_fields.py  → Добавление районов
│
├── 📄 .env                         ← КОНФИГУРАЦИЯ (создаётся скриптом)
│   • TELEGRAM_BOT_TOKEN            → Токен бота
│   • ADMIN_TELEGRAM_IDS=6840100810 → ВАШ ID админа ✅
│   • DATABASE_URL                  → Путь к БД
│   • Тарифы, настройки
│
├── 📄 taxi_zhukovo.db              ← База данных SQLite
│
├── 🚀 run.py                       ← ЗАПУСК БОТА
├── 🔧 add_admin.py                 ← Скрипт добавления админа
├── 🔧 setup_env.py                 ← Скрипт создания .env (обновлён ✅)
│
├── 📖 БЫСТРЫЙ_СТАРТ.md             ← НАЧНИТЕ ОТСЮДА!
├── 📖 ФУНКЦИОНАЛЬНОСТЬ_РОЛЕЙ.md    ← Обзор всех функций
├── 📖 НАСТРОЙКА_АДМИНА.md          ← Инструкция для админа
├── 📖 ADMIN_SETUP_COMPLETE.md      ← Полное резюме
├── 📖 СХЕМА_ПРОЕКТА.md             ← Этот файл
└── 📖 README_ADMIN.txt             ← Краткая инструкция
```

---

## 🎯 Схема работы системы районов

```
                        КЛИЕНТ СОЗДАЁТ ЗАКАЗ
                                │
                    ┌───────────┴───────────┐
                    │   Выбирает район:     │
                    │   "Дёма"              │
                    └───────────┬───────────┘
                                │
                                ▼
                    ┌──────────────────────┐
                    │ СИСТЕМА ИЩЕТ         │
                    │ ВОДИТЕЛЕЙ            │
                    └──────────┬───────────┘
                               │
          ┌────────────────────┼────────────────────┐
          │                    │                    │
          ▼                    ▼                    ▼
┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐
│ Водитель 1      │  │ Водитель 2      │  │ Водитель 3      │
│ Район: Дёма     │  │ Район: Дёма     │  │ Район: Дёма     │
│ Время: 10:00    │  │ Время: 10:05    │  │ Время: 10:10    │
│ ✅ ПЕРВЫЙ       │  │ ⏳ Второй       │  │ ⏳ Третий       │
└─────────────────┘  └─────────────────┘  └─────────────────┘
         │
         ▼
┌─────────────────────────────────────────┐
│ ✅ Принимает заказ                      │
│ (FIFO — первый вышел, первый получил)   │
└─────────────────────────────────────────┘
         │
         ▼
┌─────────────────────────────────────────┐
│ Если НЕТ водителей в районе заказа:     │
│ ⏰ Ожидание 60 секунд                   │
│ → Уведомление водителей "Новое Жуково"  │
└─────────────────────────────────────────┘
```

---

## 💰 Схема расчёта тарифов

```
                     КЛИЕНТ УКАЗЫВАЕТ АДРЕСА
                                │
                                ▼
                    ┌───────────────────────┐
                    │ Система рассчитывает  │
                    │ расстояние (км)       │
                    └───────────┬───────────┘
                                │
                ┌───────────────┴───────────────┐
                │                               │
                ▼                               ▼
    ┌───────────────────────┐       ┌───────────────────────┐
    │ Расстояние ≤ 15 км    │       │ Расстояние > 15 км    │
    │ (ГОРОД)               │       │ (МЕЖГОРОД)            │
    └───────────┬───────────┘       └───────────┬───────────┘
                │                               │
                ▼                               ▼
    ┌───────────────────────┐       ┌───────────────────────┐
    │ Формула:              │       │ Формула:              │
    │ Цена = 100 + км × 25  │       │ Цена = км × 36        │
    │ Минимум: 150 ₽        │       │                       │
    └───────────┬───────────┘       └───────────┬───────────┘
                │                               │
                └───────────────┬───────────────┘
                                │
                                ▼
                    ┌───────────────────────┐
                    │ Клиент видит цену     │
                    │ перед подтверждением  │
                    └───────────────────────┘
```

---

## 🧪 Схема тестирования

```
┌─────────────────────────────────────────────────────────────────┐
│                     ТЕСТОВАЯ СРЕДА                              │
└─────────────────────────────────────────────────────────────────┘
                              │
         ┌────────────────────┼────────────────────┐
         │                    │                    │
         ▼                    ▼                    ▼
┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐
│ АККАУНТ 1       │  │ АККАУНТ 2       │  │ АККАУНТ 3       │
│ 👨‍💼 АДМИН       │  │ 🚗 ВОДИТЕЛЬ     │  │ 👤 КЛИЕНТ       │
│ ID: 6840100810  │  │ ID: тестовый    │  │ ID: тестовый    │
└─────────────────┘  └─────────────────┘  └─────────────────┘
         │                    │                    │
         ▼                    ▼                    ▼
┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐
│ Команды:        │  │ Действия:       │  │ Действия:       │
│ /admin_stats    │  │ 1. /start       │  │ 1. /start       │
│ /list_drivers   │  │ 2. Ждёт         │  │ 2. Заказать     │
│ /verify_driver  │  │    верификацию  │  │    такси        │
│ /pending_orders │  │ 3. Выйти на     │  │ 3. Выбрать      │
│                 │  │    линию        │  │    район        │
│                 │  │ 4. Принять      │  │ 4. Указать      │
│                 │  │    заказ        │  │    адреса       │
└─────────────────┘  └─────────────────┘  └─────────────────┘
```

---

## 🔄 Жизненный цикл заказа

```
1. СОЗДАНИЕ
   ⬇
   Клиент: Выбор района + адреса
   ⬇
   Статус: pending (⏳)

2. ПОИСК ВОДИТЕЛЯ
   ⬇
   Система: Уведомляет водителей из района (FIFO)
   ⬇
   Ожидание 60 сек → расширение поиска

3. ПРИНЯТИЕ
   ⬇
   Водитель: Нажимает "Принять заказ"
   ⬇
   Статус: accepted (✅)

4. ВЫПОЛНЕНИЕ
   ⬇
   Водитель: "Начать поездку"
   ⬇
   Статус: in_progress (🚗)

5. ЗАВЕРШЕНИЕ
   ⬇
   Водитель: "Завершить поездку"
   ⬇
   Статус: completed (✅)

6. ОЦЕНКА
   ⬇
   Клиент: Оценивает водителя (1-5 ⭐)
   ⬇
   Рейтинг водителя обновлён
```

---

## 📝 Чек-лист запуска

```
☐ 1. Установить зависимости
     pip install -r requirements.txt

☐ 2. Создать .env файл
     python add_admin.py
     ИЛИ
     python setup_env.py

☐ 3. Проверить .env
     ✓ TELEGRAM_BOT_TOKEN присутствует
     ✓ ADMIN_TELEGRAM_IDS=6840100810

☐ 4. Запустить бота
     python run.py

☐ 5. Проверить в Telegram
     /start
     /admin_stats

☐ 6. Протестировать функции
     ✓ Создать тестовых водителей
     ✓ Создать тестовые заказы
     ✓ Проверить систему районов

☐ 7. Изучить документацию
     ✓ БЫСТРЫЙ_СТАРТ.md
     ✓ ФУНКЦИОНАЛЬНОСТЬ_РОЛЕЙ.md
```

---

## 🎉 ГОТОВО!

**Ваш статус:** АДМИНИСТРАТОР ✅  
**Telegram ID:** 6840100810  
**Доступ:** Полный контроль системы

### Что дальше:

1. 📖 Откройте `БЫСТРЫЙ_СТАРТ.md` для запуска
2. 📖 Откройте `ФУНКЦИОНАЛЬНОСТЬ_РОЛЕЙ.md` для изучения всех функций
3. 🚀 Запустите бота: `python add_admin.py && python run.py`
4. ✅ Проверьте права: `/admin_stats`

**Успехов в управлении ботом «Такси Жуково+»! 🚖**

