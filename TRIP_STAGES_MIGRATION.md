# –ú–∏–≥—Ä–∞—Ü–∏—è: –≠—Ç–∞–ø—ã –ø–æ–µ–∑–¥–∫–∏ –∏ —Ä–µ–π—Ç–∏–Ω–≥–∏

## –ß—Ç–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ

### 1. –ù–æ–≤—ã–µ —Å—Ç–∞—Ç—É—Å—ã –∑–∞–∫–∞–∑–∞
- `ARRIVED` - –≤–æ–¥–∏—Ç–µ–ª—å –ø–æ–¥—ä–µ—Ö–∞–ª
- `ONBOARD` - –ø–æ–µ–∑–¥–∫–∞ –Ω–∞—á–∞–ª–∞—Å—å (–∫–ª–∏–µ–Ω—Ç –≤ –º–∞—à–∏–Ω–µ)
- `FINISHED` - –ø–æ–µ–∑–¥–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞

### 2. –ù–æ–≤—ã–µ –ø–æ–ª—è –≤ –ë–î

**–¢–∞–±–ª–∏—Ü–∞ `orders`:**
- `arrived_at` - –≤—Ä–µ–º—è –ø–æ–¥—ä–µ–∑–¥–∞ –≤–æ–¥–∏—Ç–µ–ª—è
- `finished_at` - –≤—Ä–µ–º—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø–æ–µ–∑–¥–∫–∏
- `rating_comment` - –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ –æ—Ü–µ–Ω–∫–µ

**–¢–∞–±–ª–∏—Ü–∞ `drivers`:**
- `rating_avg` - —Å—Ä–µ–¥–Ω–∏–π —Ä–µ–π—Ç–∏–Ω–≥ (–¥—É–±–ª–∏–∫–∞—Ç `rating` –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏)
- `rating_count` - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ü–µ–Ω–æ–∫

### 3. –ù–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

**–î–ª—è –≤–æ–¥–∏—Ç–µ–ª—è:**
- üöó –ü–æ–¥—ä–µ—Ö–∞–ª - —É–≤–µ–¥–æ–º–ª—è–µ—Ç –∫–ª–∏–µ–Ω—Ç–∞
- ‚åõ –ñ–¥—É –∫–ª–∏–µ–Ω—Ç–∞ - –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç—É
- ‚ñ∂Ô∏è –ü–æ–µ—Ö–∞–ª–∏ - –Ω–∞—á–∏–Ω–∞–µ—Ç –ø–æ–µ–∑–¥–∫—É
- üèÅ –ó–∞–≤–µ—Ä—à–∏—Ç—å –ø–æ–µ–∑–¥–∫—É - –∑–∞–≤–µ—Ä—à–∞–µ—Ç –ø–æ–µ–∑–¥–∫—É –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤ –æ—á–µ—Ä–µ–¥—å

**–î–ª—è –∫–ª–∏–µ–Ω—Ç–∞:**
- üí¨ –ù–∞–ø–∏—Å–∞—Ç—å –≤–æ–¥–∏—Ç–µ–ª—é - –∫–Ω–æ–ø–∫–∞ —Å –∫–æ–Ω—Ç–∞–∫—Ç–∞–º–∏
- üìû –ü–æ–∑–≤–æ–Ω–∏—Ç—å - –∫–Ω–æ–ø–∫–∞ –∑–≤–æ–Ω–∫–∞ (–µ—Å–ª–∏ –µ—Å—Ç—å —Ç–µ–ª–µ—Ñ–æ–Ω)
- üö∂ –í—ã—Ö–æ–∂—É - —É–≤–µ–¥–æ–º–ª—è–µ—Ç –≤–æ–¥–∏—Ç–µ–ª—è
- ‚≠ê1-5 - –æ—Ü–µ–Ω–∫–∞ –ø–æ–µ–∑–¥–∫–∏
- ‚úçÔ∏è –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π - –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ –æ—Ü–µ–Ω–∫–µ

## –ö–∞–∫ –ø—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é

1. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é –ë–î:**
   ```bash
   python database/migrations/add_trip_stages.py
   ```

2. **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞:**
   ```bash
   python run.py
   ```

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –¢–µ—Å—Ç 1: –û—á–µ—Ä–µ–¥–Ω–æ–π –∑–∞–∫–∞–∑
1. –ö–ª–∏–µ–Ω—Ç —Å–æ–∑–¥–∞–µ—Ç –∑–∞–∫–∞–∑
2. –í–æ–¥–∏—Ç–µ–ª—å –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∑–∞–∫–∞–∑ ‚Üí –≤–∏–¥–∏—Ç –∫–Ω–æ–ø–∫–∏ "–ü–æ–¥—ä–µ—Ö–∞–ª", "–ñ–¥—É –∫–ª–∏–µ–Ω—Ç–∞", "–û—Ç–º–µ–Ω–∏—Ç—å"
3. –í–æ–¥–∏—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç "–ü–æ–¥—ä–µ—Ö–∞–ª" ‚Üí –∫–ª–∏–µ–Ω—Ç –ø–æ–ª—É—á–∞–µ—Ç "–í–æ–¥–∏—Ç–µ–ª—å –Ω–∞ –º–µ—Å—Ç–µ. –Ø –≤—ã—Ö–æ–∂—É?"
4. –í–æ–¥–∏—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç "–ü–æ–µ—Ö–∞–ª–∏" ‚Üí –∫–ª–∏–µ–Ω—Ç –ø–æ–ª—É—á–∞–µ—Ç "–ü–æ–µ–∑–¥–∫–∞ –Ω–∞—á–∞–ª–∞—Å—å"
5. –í–æ–¥–∏—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç "–ó–∞–≤–µ—Ä—à–∏—Ç—å –ø–æ–µ–∑–¥–∫—É" ‚Üí –∫–ª–∏–µ–Ω—Ç –≤–∏–¥–∏—Ç –∫–Ω–æ–ø–∫–∏ –æ—Ü–µ–Ω–∫–∏ ‚≠ê1-5
6. –ö–ª–∏–µ–Ω—Ç –æ—Ü–µ–Ω–∏–≤–∞–µ—Ç ‚Üí –≤–æ–¥–∏—Ç–µ–ª—å –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ –æ—á–µ—Ä–µ–¥—å

### –¢–µ—Å—Ç 2: Broadcast-–∑–∞–∫–∞–∑
1. –ö–ª–∏–µ–Ω—Ç —Å–æ–∑–¥–∞–µ—Ç broadcast-–∑–∞–∫–∞–∑ (–∏–∑ –£—Ñ—ã/–ê—ç—Ä–æ–ø–æ—Ä—Ç–∞)
2. –ü–æ—Å–ª–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –≤–æ–¥–∏—Ç–µ–ª—è ‚Üí —Ç–µ –∂–µ –∫–Ω–æ–ø–∫–∏ –∏ –∫–æ–Ω—Ç–∞–∫—Ç—ã

### –¢–µ—Å—Ç 3: –ö–æ–Ω—Ç–∞–∫—Ç—ã
1. –ï—Å–ª–∏ —É –≤–æ–¥–∏—Ç–µ–ª—è –µ—Å—Ç—å username ‚Üí –∫–Ω–æ–ø–∫–∞ "üí¨ –ù–∞–ø–∏—Å–∞—Ç—å –≤–æ–¥–∏—Ç–µ–ª—é" —Å —Å—Å—ã–ª–∫–æ–π `https://t.me/username`
2. –ï—Å–ª–∏ –Ω–µ—Ç username ‚Üí –∫–Ω–æ–ø–∫–∞ —Å `tg://user?id=telegram_id`
3. –ï—Å–ª–∏ –µ—Å—Ç—å —Ç–µ–ª–µ—Ñ–æ–Ω ‚Üí –∫–Ω–æ–ø–∫–∞ "üìû –ü–æ–∑–≤–æ–Ω–∏—Ç—å"

## –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **–û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å:** –°—Ç–∞—Ä—ã–µ —Å—Ç–∞—Ç—É—Å—ã (`IN_PROGRESS`, `COMPLETED`) –≤—Å–µ –µ—â–µ —Ä–∞–±–æ—Ç–∞—é—Ç, –Ω–æ –º–∞–ø–ø—è—Ç—Å—è –Ω–∞ –Ω–æ–≤—ã–µ
2. **–†–µ–π—Ç–∏–Ω–≥–∏:** –ü—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –æ—Ü–µ–Ω–∫–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è —Å—Ä–µ–¥–Ω–∏–π —Ä–µ–π—Ç–∏–Ω–≥ –≤–æ–¥–∏—Ç–µ–ª—è
3. **–û—á–µ—Ä–µ–¥—å:** –ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø–æ–µ–∑–¥–∫–∏ –≤–æ–¥–∏—Ç–µ–ª—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ –æ—á–µ—Ä–µ–¥—å —Å–≤–æ–µ–π –∑–æ–Ω—ã
4. **–°–∞–Ω–∫—Ü–∏–∏:** –õ–æ–≥–∏–∫–∞ —Å–∞–Ω–∫—Ü–∏–π –ø—Ä–∏ –æ—Ç–º–µ–Ω–µ –ø–æ—Å–ª–µ 5 –º–∏–Ω—É—Ç –æ—Å—Ç–∞–µ—Ç—Å—è –ø—Ä–µ–∂–Ω–µ–π

## –§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã

- `bot/models/order.py` - –Ω–æ–≤—ã–µ —Å—Ç–∞—Ç—É—Å—ã –∏ –ø–æ–ª—è
- `bot/models/driver.py` - –Ω–æ–≤—ã–µ –ø–æ–ª—è —Ä–µ–π—Ç–∏–Ω–≥–∞
- `bot/utils/keyboards.py` - –Ω–æ–≤—ã–µ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
- `bot/services/order_service.py` - –Ω–æ–≤—ã–µ –º–µ—Ç–æ–¥—ã
- `bot/handlers/driver_trip.py` - –Ω–æ–≤—ã–µ —Ö—ç–Ω–¥–ª–µ—Ä—ã –¥–ª—è –≤–æ–¥–∏—Ç–µ–ª—è
- `bot/handlers/user_rating.py` - –Ω–æ–≤—ã–µ —Ö—ç–Ω–¥–ª–µ—Ä—ã –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞
- `bot/services/order_dispatcher.py` - –æ–±–Ω–æ–≤–ª–µ–Ω–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞
- `bot/handlers/driver_queue.py` - –æ–±–Ω–æ–≤–ª–µ–Ω–æ –ø—Ä–∏–Ω—è—Ç–∏–µ –∑–∞–∫–∞–∑–∞
- `database/migrations/add_trip_stages.py` - –º–∏–≥—Ä–∞—Ü–∏—è –ë–î


