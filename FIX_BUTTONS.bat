@echo off
chcp 65001 >nul
color 0A
echo.
echo ╔══════════════════════════════════════════════════════════════════════════╗
echo ║                                                                          ║
echo ║              🔧 БЫСТРОЕ ИСПРАВЛЕНИЕ ПРОБЛЕМЫ С КНОПКАМИ                 ║
echo ║                                                                          ║
echo ╚══════════════════════════════════════════════════════════════════════════╝
echo.
cd /d "%~dp0"

echo [Шаг 1/4] Остановка предыдущего бота...
taskkill /F /IM python.exe /T >nul 2>&1
echo ✓ Готово
echo.

echo [Шаг 2/4] Проверка файла .env...
if not exist .env (
    echo ⚠️  Создаю .env...
    python create_env.py
    if errorlevel 1 (
        echo ❌ Ошибка создания .env!
        echo.
        echo Создайте файл .env вручную:
        echo 1. Откройте Блокнот
        echo 2. Скопируйте содержимое из .env.example
        echo 3. Сохраните как .env
        pause
        exit /b 1
    )
)
echo ✓ Файл .env существует
echo.

echo [Шаг 3/4] Проверка зависимостей...
python -c "import telegram, sqlalchemy, pydantic_settings" 2>nul
if errorlevel 1 (
    echo ⚠️  Установка недостающих библиотек...
    pip install python-telegram-bot sqlalchemy pydantic-settings
    if errorlevel 1 (
        echo ❌ Ошибка установки зависимостей!
        pause
        exit /b 1
    )
)
echo ✓ Все библиотеки установлены
echo.

echo [Шаг 4/4] Запуск бота с диагностикой...
echo.
echo ════════════════════════════════════════════════════════════════════════════
echo    ✅ ЗАПУСКАЮ БОТА...
echo ════════════════════════════════════════════════════════════════════════════
echo.
echo 💡 Смотрите на результаты проверок ниже!
echo.
echo ════════════════════════════════════════════════════════════════════════════
echo.

python test_bot.py

echo.
echo ════════════════════════════════════════════════════════════════════════════
echo    ⚠️ БОТ ОСТАНОВЛЕН
echo ════════════════════════════════════════════════════════════════════════════
echo.
echo Если были ошибки - внимательно прочитайте их выше!
echo.
pause

